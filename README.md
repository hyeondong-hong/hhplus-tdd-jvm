### 프로젝트 개요
이 프로젝트는 포인트 관리 시스템에서 **Test Driven Development** (TDD)를 적용하여, 충전과 사용 기능을 안정적으로
구현하고 동시성 문제를 해결하는 방법을 탐구하는 과정을 다룹니다. 주된 목표는 포인트 충전, 사용, 조회, 내역 조회 등 핵심
기능을 구현하고, 이를 테스트 주도 개발 방식으로 개발하여 안정성을 확보하는 것입니다. 동시성 제어 문제를 효과적으로
해결하기 위한 다양한 기법이 논의됐습니다.


### 주요 요구 사항

1. 포인트 관련 API 기능
   - **PATCH** /point/{id}/charge: 포인트를 충전하는 기능.
   - **PATCH** /point/{id}/use: 포인트를 사용하는 기능.
   - **GET** /point/{id}: 특정 유저의 포인트 잔고를 조회하는 기능.
   - **GET** /point/{id}/histories: 포인트 내역을 조회하는 기능.
   - 동시에 여러 건의 포인트 충전 또는 사용 요청이 들어올 때 **순차적으로 처리**될 수 있어야 하며, 잔고가 부족한 경우 포인트
    사용 요청은 실패해야 합니다.

2. TDD 기반 개발 프로세스
   - **기본 기능**으로 포인트의 충전, 사용, 조회 기능을 개발한 후, 이들 기능에 대한 **단위 테스트**를 작성합니다.
   - **동시성 문제**를 해결하기 위해 여러 요청이 동시에 들어오더라도 이를 안전하게 처리할 수 있는 리팩토링을 수행합니다.
   - 동시성 제어 방식에 대해 분석하고 **보고서**를 작성하며, 동시성 제어에 대한 **통합 테스트**를 수행합니다.


### 동시성 제어 방식

처음에는 자바의 `synchronized` 키워드를 사용하여 메소드 단위의 동기화 처리를 시도했으나, **레이스 컨디션** 문제가 발생할
가능성이 확인됐습니다. 이를 해결하기 위해 유저 별로 동기화를 분리하는 방식이 도입됐습니다. 하지만 이 방식도 한계를
보여, 다음과 같은 개선이 이뤄졌습니다.

1. `ReentrantLock`
   - 동시성 제어와 대기 순서를 보장하는 락을 사용하여 `synchronized`보다 더 세밀한 동시성 제어가 가능하도록 설계됐습니다.
   - `ReentrantLock`을 활용한 **VirtualTransaction** 컴포넌트가 구현되어, 각 요청이 처리될 때 **Lock**을 걸고,
    **Unlock**을 통해 요청을 제어하는 구조로 변경됐습니다.

2. `ConcurrentHashMap`
   - `WeakHashMap`을 사용하여 불필요한 메모리 점유를 줄이려 했으나, **ConcurrentHashMap**이 동기화 및 성능 측면에서 더
    나은 결과를 보였습니다. **키 단위로 동기화를 보장**하면서 동시에 메모리 관리 문제도 해결할 수 있었습니다.

이 과정에서 테이블 타입과 유저 ID에 따라 동기화가 이뤄지도록 하여, 서로 다른 테이블 간의 동시 접근에 대한 락 문제를
해결했습니다. 최종적으로 **유저와 테이블을 구분하여 안전한 동시성 처리가 가능**하도록 설계됐습니다.


### 테스트 과정

1. 단위 테스트 (Unit Test):
   - 각 메소드의 동작을 검증하기 위해 **Mock 객체**를 사용했으며, 각 기능이 정상적으로 작동하는지를 테스트했습니다.
   - 포인트 충전과 사용 시 발생할 수 있는 예외 상황을 테스트했고, 음수 값 입력 또는 최대 보유량을 초과하는 상황에 대한
    예외 처리를 검증했습니다.

2. 통합 테스트 (Integration Test):
   - 실제 의존성 주입을 통해, 여러 요청이 동시에 들어왔을 때도 시스템이 **정상적으로 동작**하는지를 검증했습니다.
   - 예를 들어, 충전과 사용 요청이 거의 동시에 들어왔을 때도 올바르게 처리되는지, 포인트 내역이 일관성 있게 기록되는지를
    확인했습니다.
   - 테스트 결과, 각 요청이 순차적으로 처리됐으며, 최종 포인트 잔액이 기대한 값과 일치하는 것을 확인했습니다.


### 진행 중 겪은 어려움

1. **의존성 주입(DI)** 개념에 대한 이해가 필요했습니다. 사용하던 **Python Django**와는 다르게, Spring에서 제공하는 DI
  개념을 활용하는 데 있어 학습 시간이 소요됐습니다.
2. **Mock**과 **Stub**에 대한 이해 부족으로 인해, 테스트 코드 작성 시 예상치 못한 문제를 겪었습니다. 실제 코드에서
  발생하는 문제인지, 테스트 환경의 문제인지 구분하는 데 시간이 걸렸습니다.
3. **TDD 방식**에 익숙하지 않아, 단위 테스트와 통합 테스트의 차이점과 테스트 코드 작성 규칙을 이해하는 데 시간이
  걸렸습니다.


### 결론

이 프로젝트는 포인트 서비스에서의 동시성 문제를 해결하고, 이를 **테스트 주도 개발** 방식으로 검증하는 과정을 통해
안정적인 서비스 운영을 목표로 하고 있습니다. 이를 통해 Java의 동시성 처리 방법에 대한 깊은 이해와 함께,
**ReentrantLock**, **ConcurrentHashMap**을 활용한 고성능 동시성 제어 기법을 습득했습니다.
